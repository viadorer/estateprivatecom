# üè† Realitn√≠ Projekt - Kompletn√≠ Pl√°n P≈ôemƒõny

## üìã P≈ôehled

P≈ôemƒõna Task Manageru na **profesion√°ln√≠ realitn√≠ aplikaci** s:
- üè¢ Datab√°z√≠ nemovitost√≠ (prodej/pron√°jem)
- üë• Syst√©mem u≈æivatelsk√Ωch rol√≠ a pr√°v
- üîç Popt√°vkami a automatick√Ωm matchov√°n√≠m
- üåê Integrac√≠ Sreality API
- üìä Pokroƒçil√Ωm filtrov√°n√≠m

---

## üóÑÔ∏è Datab√°zov√© Sch√©ma

### **Tabulky**

#### 1. **users** (U≈æivatel√©)
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  role TEXT NOT NULL, -- 'admin', 'agent', 'client'
  phone TEXT,
  avatar TEXT,
  company TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**Role:**
- **admin** üëë - Spr√°va cel√©ho syst√©mu
- **agent** üè¢ - Realitn√≠ makl√©≈ô (p≈ôid√°v√° nab√≠dky, spravuje klienty)
- **client** üë§ - Klient (vytv√°≈ô√≠ popt√°vky, prohl√≠≈æ√≠ nab√≠dky)

#### 2. **properties** (Nemovitosti)
```sql
CREATE TABLE properties (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT,
  
  -- Typ transakce
  transaction_type TEXT NOT NULL, -- 'sale', 'rent'
  
  -- Typ nemovitosti
  property_type TEXT NOT NULL, -- 'flat', 'house', 'commercial', 'land'
  property_subtype TEXT, -- '1+kk', '2+1', 'rodinny_dum', 'pozemek' atd.
  
  -- Cena
  price REAL NOT NULL,
  price_note TEXT, -- 'za mƒõs√≠c', 'dohodou' atd.
  
  -- Lokace
  city TEXT NOT NULL,
  district TEXT,
  street TEXT,
  zip_code TEXT,
  latitude REAL,
  longitude REAL,
  
  -- Parametry
  area REAL, -- m¬≤
  land_area REAL, -- m¬≤ pozemku
  rooms INTEGER,
  floor INTEGER,
  total_floors INTEGER,
  
  -- Vlastnosti
  building_type TEXT, -- 'brick', 'panel', 'wood'
  building_condition TEXT, -- 'new_building', 'after_reconstruction', 'original'
  ownership TEXT, -- 'personal', 'cooperative'
  
  -- Vybaven√≠
  furnished TEXT, -- 'furnished', 'partly_furnished', 'not_furnished'
  has_balcony BOOLEAN DEFAULT 0,
  has_terrace BOOLEAN DEFAULT 0,
  has_cellar BOOLEAN DEFAULT 0,
  has_garage BOOLEAN DEFAULT 0,
  has_parking BOOLEAN DEFAULT 0,
  has_elevator BOOLEAN DEFAULT 0,
  has_garden BOOLEAN DEFAULT 0,
  has_pool BOOLEAN DEFAULT 0,
  
  -- Energie
  energy_rating TEXT, -- 'A', 'B', 'C', 'D', 'E', 'F', 'G'
  heating_type TEXT, -- 'gas', 'electric', 'central'
  
  -- Spr√°va
  agent_id INTEGER NOT NULL,
  status TEXT DEFAULT 'active', -- 'active', 'reserved', 'sold', 'archived'
  views_count INTEGER DEFAULT 0,
  
  -- Obr√°zky
  images TEXT, -- JSON array URL obr√°zk≈Ø
  main_image TEXT,
  
  -- Sreality integrace
  sreality_id TEXT UNIQUE,
  
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (agent_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 3. **demands** (Popt√°vky)
```sql
CREATE TABLE demands (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  client_id INTEGER NOT NULL,
  
  -- Co hled√°
  transaction_type TEXT NOT NULL, -- 'sale', 'rent'
  property_type TEXT NOT NULL,
  property_subtype TEXT,
  
  -- Cenov√© rozpƒõt√≠
  price_min REAL,
  price_max REAL,
  
  -- Lokace
  cities TEXT, -- JSON array mƒõst
  districts TEXT, -- JSON array ƒç√°st√≠
  
  -- Parametry
  area_min REAL,
  area_max REAL,
  rooms_min INTEGER,
  rooms_max INTEGER,
  floor_min INTEGER,
  floor_max INTEGER,
  
  -- Po≈æadavky
  required_features TEXT, -- JSON array po≈æadovan√Ωch vlastnost√≠
  
  -- Stav
  status TEXT DEFAULT 'active', -- 'active', 'fulfilled', 'cancelled'
  
  -- Notifikace
  email_notifications BOOLEAN DEFAULT 1,
  
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (client_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 4. **matches** (Shody popt√°vek s nab√≠dkami)
```sql
CREATE TABLE matches (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  demand_id INTEGER NOT NULL,
  property_id INTEGER NOT NULL,
  match_score INTEGER, -- 0-100 sk√≥re shody
  status TEXT DEFAULT 'new', -- 'new', 'viewed', 'interested', 'rejected'
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (demand_id) REFERENCES demands(id) ON DELETE CASCADE,
  FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE
);
```

#### 5. **favorites** (Obl√≠ben√©)
```sql
CREATE TABLE favorites (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  property_id INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE,
  UNIQUE(user_id, property_id)
);
```

#### 6. **viewings** (Prohl√≠dky)
```sql
CREATE TABLE viewings (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  property_id INTEGER NOT NULL,
  client_id INTEGER NOT NULL,
  agent_id INTEGER NOT NULL,
  
  scheduled_at DATETIME NOT NULL,
  duration INTEGER DEFAULT 30, -- minuty
  status TEXT DEFAULT 'scheduled', -- 'scheduled', 'completed', 'cancelled'
  notes TEXT,
  
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (property_id) REFERENCES properties(id) ON DELETE CASCADE,
  FOREIGN KEY (client_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (agent_id) REFERENCES users(id) ON DELETE CASCADE
);
```

---

## üéØ Syst√©m Pr√°v

### **Admin** üëë
- ‚úÖ V≈°e
- ‚úÖ Spr√°va v≈°ech u≈æivatel≈Ø
- ‚úÖ Spr√°va v≈°ech nemovitost√≠
- ‚úÖ Statistiky a reporty
- ‚úÖ Nastaven√≠ syst√©mu

### **Agent** üè¢ (Realitn√≠ makl√©≈ô)
- ‚úÖ P≈ôid√°v√°n√≠/editace/maz√°n√≠ vlastn√≠ch nemovitost√≠
- ‚úÖ Zobrazen√≠ v≈°ech nemovitost√≠ (read-only ostatn√≠ch agent≈Ø)
- ‚úÖ Spr√°va vlastn√≠ch klient≈Ø
- ‚úÖ Pl√°nov√°n√≠ prohl√≠dek
- ‚úÖ Zobrazen√≠ match≈Ø pro sv√© nemovitosti
- ‚ùå Nem≈Ø≈æe mazat jin√© agenty
- ‚ùå Nem≈Ø≈æe mƒõnit syst√©mov√° nastaven√≠

### **Client** üë§ (Klient)
- ‚úÖ Vytv√°≈ôen√≠ popt√°vek
- ‚úÖ Prohl√≠≈æen√≠ nab√≠dek
- ‚úÖ Obl√≠ben√© nemovitosti
- ‚úÖ ≈Ω√°dosti o prohl√≠dky
- ‚úÖ Zobrazen√≠ match≈Ø pro sv√© popt√°vky
- ‚ùå Nem≈Ø≈æe p≈ôid√°vat nemovitosti
- ‚ùå Nem≈Ø≈æe vidƒõt kontakty ostatn√≠ch klient≈Ø

---

## üîç Syst√©m Matchov√°n√≠

### **Algoritmus**

```javascript
function calculateMatch(demand, property) {
  let score = 0;
  let maxScore = 0;
  
  // Typ transakce (MUST match)
  if (demand.transaction_type !== property.transaction_type) return 0;
  
  // Typ nemovitosti (MUST match)
  if (demand.property_type !== property.property_type) return 0;
  
  // Cena (30 bod≈Ø)
  maxScore += 30;
  if (property.price >= demand.price_min && property.price <= demand.price_max) {
    score += 30;
  } else if (property.price < demand.price_min * 1.2 || property.price > demand.price_max * 0.8) {
    score += 15; // ƒå√°steƒçn√° shoda
  }
  
  // Lokace (25 bod≈Ø)
  maxScore += 25;
  if (demand.cities.includes(property.city)) {
    score += 25;
  }
  
  // Plocha (20 bod≈Ø)
  maxScore += 20;
  if (property.area >= demand.area_min && property.area <= demand.area_max) {
    score += 20;
  }
  
  // Poƒçet pokoj≈Ø (15 bod≈Ø)
  maxScore += 15;
  if (property.rooms >= demand.rooms_min && property.rooms <= demand.rooms_max) {
    score += 15;
  }
  
  // Po≈æadovan√© vlastnosti (10 bod≈Ø)
  maxScore += 10;
  const matchedFeatures = demand.required_features.filter(f => 
    property[f] === true
  );
  score += (matchedFeatures.length / demand.required_features.length) * 10;
  
  return Math.round((score / maxScore) * 100);
}
```

### **Kdy se vytv√°≈ô√≠ match?**
- ‚úÖ P≈ôi vytvo≈ôen√≠ nov√© popt√°vky ‚Üí projdou se v≈°echny aktivn√≠ nab√≠dky
- ‚úÖ P≈ôi p≈ôid√°n√≠ nov√© nab√≠dky ‚Üí projdou se v≈°echny aktivn√≠ popt√°vky
- ‚úÖ Match se vytvo≈ô√≠ pouze pokud score >= 60%

---

## üì° API Endpointy

### **Auth**
- `POST /api/auth/login` - P≈ôihl√°≈°en√≠
- `POST /api/auth/register` - Registrace

### **Users**
- `GET /api/users` - Seznam u≈æivatel≈Ø (admin)
- `GET /api/users/:id` - Detail u≈æivatele
- `PUT /api/users/:id` - Aktualizace
- `DELETE /api/users/:id` - Smaz√°n√≠ (admin)

### **Properties**
- `GET /api/properties` - Seznam nemovitost√≠ (s filtry)
- `GET /api/properties/:id` - Detail nemovitosti
- `POST /api/properties` - P≈ôid√°n√≠ (agent, admin)
- `PUT /api/properties/:id` - Aktualizace (vlastn√≠k, admin)
- `DELETE /api/properties/:id` - Smaz√°n√≠ (vlastn√≠k, admin)
- `GET /api/properties/my` - Moje nemovitosti (agent)

### **Demands**
- `GET /api/demands` - Seznam popt√°vek
- `GET /api/demands/:id` - Detail popt√°vky
- `POST /api/demands` - Vytvo≈ôen√≠ (client, agent, admin)
- `PUT /api/demands/:id` - Aktualizace (vlastn√≠k)
- `DELETE /api/demands/:id` - Smaz√°n√≠ (vlastn√≠k)
- `GET /api/demands/my` - Moje popt√°vky

### **Matches**
- `GET /api/matches/demand/:id` - Shody pro popt√°vku
- `GET /api/matches/property/:id` - Shody pro nemovitost
- `PUT /api/matches/:id/status` - Zmƒõna stavu

### **Favorites**
- `GET /api/favorites` - Obl√≠ben√©
- `POST /api/favorites` - P≈ôidat do obl√≠ben√Ωch
- `DELETE /api/favorites/:id` - Odebrat

### **Viewings**
- `GET /api/viewings` - Seznam prohl√≠dek
- `POST /api/viewings` - Napl√°novat prohl√≠dku
- `PUT /api/viewings/:id` - Aktualizovat
- `DELETE /api/viewings/:id` - Zru≈°it

### **Sreality**
- `GET /api/sreality/import` - Import z Sreality API
- `GET /api/sreality/sync/:id` - Synchronizace konkr√©tn√≠ nemovitosti

### **Stats**
- `GET /api/stats` - Statistiky (dashboard)

---

## üé® Frontend Komponenty

### **Str√°nky**

1. **Dashboard** üìä
   - Statistiky (poƒçty nemovitost√≠, popt√°vek, match≈Ø)
   - Posledn√≠ aktivity
   - Grafy (ceny, typy nemovitost√≠)

2. **Properties** üè† (Nab√≠dky)
   - Seznam s filtry
   - Mapa s piny
   - Detail nemovitosti
   - Formul√°≈ô pro p≈ôid√°n√≠/editaci

3. **Demands** üîç (Popt√°vky)
   - Seznam popt√°vek
   - Formul√°≈ô pro vytvo≈ôen√≠
   - Matches pro popt√°vku

4. **Matches** üéØ (Shody)
   - Seznam match≈Ø
   - Sk√≥re shody
   - Akce (z√°jem, odm√≠tnout)

5. **Favorites** ‚≠ê (Obl√≠ben√©)
   - Seznam obl√≠ben√Ωch nemovitost√≠

6. **Viewings** üìÖ (Prohl√≠dky)
   - Kalend√°≈ô prohl√≠dek
   - Pl√°nov√°n√≠ nov√© prohl√≠dky

7. **Users** üë• (U≈æivatel√©)
   - Seznam u≈æivatel≈Ø (admin, agent)
   - Role a opr√°vnƒõn√≠

### **Komponenty**

- `PropertyCard` - Karta nemovitosti
- `PropertyDetail` - Detail nemovitosti
- `PropertyForm` - Formul√°≈ô pro nemovitost
- `PropertyFilters` - Filtry
- `PropertyMap` - Mapa s nemovitostmi
- `DemandCard` - Karta popt√°vky
- `DemandForm` - Formul√°≈ô popt√°vky
- `MatchCard` - Karta shody
- `ViewingCalendar` - Kalend√°≈ô prohl√≠dek
- `RoleBadge` - Badge role
- `PriceDisplay` - Zobrazen√≠ ceny

---

## üîß Implementaƒçn√≠ Kroky

### **F√°ze 1: Backend (2-3 hodiny)**
1. ‚úÖ Nov√© datab√°zov√© sch√©ma
2. ‚úÖ Seed data (uk√°zkov√© nemovitosti)
3. ‚úÖ API endpointy pro properties
4. ‚úÖ API endpointy pro demands
5. ‚úÖ Matching algoritmus
6. ‚úÖ Middleware pro kontrolu pr√°v

### **F√°ze 2: Frontend (3-4 hodiny)**
1. ‚úÖ P≈ôejmenov√°n√≠ aplikace
2. ‚úÖ Nov√© komponenty pro nemovitosti
3. ‚úÖ Filtry a vyhled√°v√°n√≠
4. ‚úÖ Formul√°≈ôe pro p≈ôid√°n√≠ nemovitost√≠
5. ‚úÖ Syst√©m popt√°vek
6. ‚úÖ Zobrazen√≠ match≈Ø
7. ‚úÖ Mapa nemovitost√≠ (Leaflet)

### **F√°ze 3: Pokroƒçil√© funkce (2-3 hodiny)**
1. ‚úÖ Sreality API integrace
2. ‚úÖ Obl√≠ben√© nemovitosti
3. ‚úÖ Syst√©m prohl√≠dek
4. ‚úÖ Email notifikace
5. ‚úÖ Export do PDF

### **F√°ze 4: Dokumentace (1 hodina)**
1. ‚úÖ README
2. ‚úÖ API dokumentace
3. ‚úÖ U≈æivatelsk√° p≈ô√≠ruƒçka

---

## üìä Uk√°zkov√° Data

### **Nemovitosti**
- 5 byt≈Ø na prodej (Praha, Brno)
- 3 byty na pron√°jem
- 2 rodinn√© domy
- 1 komerƒçn√≠ prostor
- 1 pozemek

### **U≈æivatel√©**
- 1 Admin
- 2 Agenti
- 3 Klienti

### **Popt√°vky**
- Byt 2+kk Praha, 5-8 mil
- D≈Øm Brno, 10-15 mil
- Pron√°jem 3+1 Praha, do 30k/mƒõs

---

## üöÄ Spu≈°tƒõn√≠

```bash
# 1. Smazat starou datab√°zi
rm backend/tasks.db

# 2. Nainstalovat z√°vislosti
npm run install:all

# 3. Spustit aplikaci
npm run dev
```

---

## üìù Pozn√°mky

- **Sreality API** je ve≈ôejn√©, ale m√° rate limiting
- **Mapy** - pou≈æ√≠t Leaflet.js nebo Mapbox
- **Obr√°zky** - ukl√°dat URL nebo upload na server
- **Email** - pou≈æ√≠t nodemailer
- **PDF** - pou≈æ√≠t jsPDF nebo puppeteer

---

*Vytvo≈ôeno: 2024-10-21*
*Odhadovan√Ω ƒças implementace: 8-10 hodin*
